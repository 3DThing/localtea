# API Маршруты (Endpoints) модуля Users

В этом документе описаны все доступные маршруты API проекта LocalTea модуля Users.
Базовый префикс для всех маршрутов: `/api/v1`.

## Пользователь (User)
Все маршруты пользователя находятся под префиксом `/user`.

### Аутентификация и Регистрация

#### `POST /user/registration`
*   **Описание**: Регистрация нового пользователя.
*   **Тело запроса**: `UserCreate` (email, username, password, и опциональные поля профиля).
*   **Ответ**: Созданный объект пользователя.
*   **Ограничения**: 2 запроса в минуту, 10 в час.
*   **Действия**: Создает пользователя в БД, отправляет письмо с подтверждением email.

#### `POST /user/login`
*   **Описание**: Вход в систему (получение токенов).
*   **Тело запроса**: `UserLogin` (email/username, password).
*   **Ответ**: JSON с `access_token`. Также устанавливает `refresh_token` и `csrf_token` в cookies.
*   **Ограничения**: 3 запроса в минуту, 20 в час.

#### `POST /user/login/access-token`
*   **Описание**: Вход в систему (совместимый с OAuth2 формой Swagger UI).
*   **Тело запроса**: `OAuth2PasswordRequestForm` (username, password).
*   **Ответ**: Аналогичен `/login`.

#### `POST /user/logout`
*   **Описание**: Выход из системы.
*   **Действия**: Аннулирует refresh token в БД, удаляет cookies.

#### `POST /user/refresh`
*   **Описание**: Обновление Access токена с помощью Refresh токена.
*   **Требования**: Наличие валидного `refresh_token` в cookies.
*   **Ответ**: Новый `access_token`.
*   **Ограничения**: 2 запроса в минуту.

### Управление профилем

Все маршруты ниже требуют аутентификации и наличия валидного CSRF токена (в заголовке `X-CSRF-Token`).

#### `GET /user/get-profile`
*   **Описание**: Получение данных текущего авторизованного пользователя.

#### `GET /user/get-public-profile/{user_id}`
*   **Описание**: Получение публичных данных любого пользователя по ID.
*   **Ответ**: `username`, `avatar_url`.

#### `POST /user/change-password`
*   **Описание**: Смена пароля.
*   **Тело запроса**: Старый пароль, новый пароль.

#### `POST /user/change-username`
*   **Описание**: Смена имени пользователя.

#### `POST /user/change-email`
*   **Описание**: Запрос на смену email.
*   **Действия**: Отправляет письмо с подтверждением на новый адрес.

#### `GET /user/confirm-email`
*   **Описание**: Подтверждение email после регистрации.
*   **Параметры**: `token` (query param).

#### `GET /user/confirm-email-change`
*   **Описание**: Подтверждение смены email.
*   **Параметры**: `token` (query param).

#### `POST /user/upload-avatar`
*   **Описание**: Загрузка аватара пользователя.
*   **Тело запроса**: Файл (multipart/form-data).

### Редактирование личных данных
Следующие маршруты позволяют изменять отдельные поля профиля:

*   `POST /user/change-firstname`
*   `POST /user/change-lastname`
*   `POST /user/change-middlename`
*   `POST /user/change-birthdate`
*   `POST /user/change-address`

## Другие модули
На данный момент модули `shop`, `order` и `admin` инициализированы, но не содержат активных маршрутов.
