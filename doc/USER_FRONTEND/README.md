# Документация User Frontend (LocalTea)

## Обзор

**User Frontend** — публичное веб-приложение интернет-магазина чая LocalTea. Предоставляет интерфейс для просмотра каталога, оформления заказов и управления профилем.

**URL Production**: `https://localtea.ru`

## Технологический стек

### Core

| Технология | Версия | Назначение |
|------------|--------|------------|
| Next.js | 15+ | React фреймворк с App Router |
| TypeScript | 5+ | Типизация |
| React | 19+ | UI библиотека |

### UI & UX

| Технология | Версия | Назначение |
|------------|--------|------------|
| Mantine | 7+ | UI компоненты |
| @mantine/notifications | 7+ | Система уведомлений |
| @tabler/icons-react | 3+ | Иконки |

### Data & State

| Технология | Назначение |
|------------|------------|
| Axios | HTTP клиент |
| Zustand | Управление состоянием |

---

## Архитектура

### Структура проекта

*   **`src/app/`**: Next.js App Router — страницы и layouts
*   **`src/components/`**: React компоненты
    *   `layout/`: Header, Footer, Navigation
    *   `catalog/`: Карточки товаров, сетка, фильтры
    *   `blog/`: Компоненты блога
*   **`src/lib/`**: Утилиты
    *   `api.ts`: Axios клиент с интерцепторами
    *   `theme.ts`: Тема Mantine
*   **`src/store/`**: Zustand stores (auth)

---

## Страницы приложения

### Главная (`/`)

*   Hero секция с промо-баннером
*   Популярные категории чая
*   Избранные товары
*   Преимущества магазина

### Каталог (`/catalog`)

*   Сетка товаров с фильтрацией
*   Фильтры по категории, типу чая
*   Сортировка (по цене, популярности)
*   Пагинация
*   Поиск товаров

### Карточка товара (`/catalog/[slug]`)

*   Галерея изображений
*   Название, описание, характеристики
*   Выбор фасовки (SKU)
*   Цена с учётом скидки
*   Кнопка добавления в корзину
*   Инструкция по завариванию
*   Комментарии и лайки

### Корзина и оформление заказа (`/cart`)

Трёхшаговый процесс оформления (Mantine Stepper):

1.  **Корзина** — просмотр товаров, изменение количества, удаление
2.  **Доставка** — выбор способа:
    *   Самовывоз (бесплатно)
    *   Почта России (расчёт стоимости по API)
3.  **Контакты и оплата** — ввод данных получателя, переход к оплате через YooKassa

### Страница успешной оплаты (`/payment/success`)

*   Подтверждение создания заказа
*   Автоматический переход к заказам через 10 секунд
*   Кнопки "Мои заказы" и "На главную"

### Профиль (`/profile`)

Личный кабинет с вкладками (Mantine Tabs):

1.  **Профиль** — основная информация, аватар
2.  **Заказы** — история заказов:
    *   Статус (Ожидает оплаты, Оплачен, Собирается, Передан в доставку, Доставлен, Отменён)
    *   Способ доставки (Самовывоз / Почта России)
    *   Трек-номер (если есть)
    *   Кнопка оплаты для неоплаченных заказов
3.  **Избранное** — сохранённые товары
4.  **Настройки** — редактирование личных данных

### Блог (`/blog`)

*   Список статей с превью
*   Поиск по статьям
*   Пагинация

### Статья блога (`/blog/[slug]`)

*   Полный текст статьи
*   Изображения
*   Комментарии
*   Лайки

### Авторизация

*   **Вход** (`/login`) — email + пароль
*   **Регистрация** (`/register`) — создание аккаунта
*   **Подтверждение email** (`/confirm-email`) — активация аккаунта

---

## Компоненты

### Layout компоненты

| Компонент | Описание |
|-----------|----------|
| Header | Шапка сайта с навигацией, поиском, корзиной |
| Footer | Подвал с контактами, ссылками, соцсетями |

### Специальные компоненты

| Компонент | Описание |
|-----------|----------|
| DeliveryDataBanner | Баннер с предложением заполнить данные для доставки |
| NotificationsContainer | Контейнер для Mantine уведомлений |
| PhoneVerificationModal | Модальное окно верификации телефона |

---

## API интеграция

### Конфигурация

API клиент на основе Axios (`src/lib/api.ts`) с:
*   Автоматическим добавлением CSRF токена из cookies
*   Автоматическим обновлением Access токена при 401 ошибке
*   Очередью запросов во время refresh токена

### API модули

| Модуль | Описание |
|--------|----------|
| catalogApi | Каталог товаров и категорий |
| blogApi | Статьи блога |
| userApi | Авторизация, профиль, настройки |
| cartApi | Корзина покупок |
| deliveryApi | Расчёт стоимости доставки |
| orderApi | Заказы |
| interactionsApi | Комментарии, лайки, просмотры |

Подробнее см. [API_REFERENCE.md](API_REFERENCE.md)

---

## Состояние приложения

### AuthStore (`src/store/index.ts`)

Zustand store для управления авторизацией:
*   `user` — текущий пользователь
*   `accessToken` — токен доступа
*   `login`, `logout`, `checkAuth`, `refreshToken` — методы

Особенности:
*   Persist accessToken в localStorage
*   Автоматическая проверка авторизации при загрузке
*   Синхронизация с API клиентом

---

## Конфигурация

### Переменные окружения

| Переменная | Описание |
|------------|----------|
| NEXT_PUBLIC_API_URL | URL бэкенда API |

### Next.js конфигурация

*   Проксирование API запросов через rewrites
*   Настройка remote patterns для изображений

---

## Тема и стили

### Mantine Theme

Кастомная тема с цветовой палитрой LocalTea:
*   Основной цвет: тёплый оранжево-коричневый
*   Тёмный фон для UI
*   Шрифты с засечками

### Глобальные стили

*   Тёмная тема по умолчанию
*   Градиентные фоны
*   Кастомные стили для карточек

---

## Развёртывание

### Docker

Приложение упаковано в Docker контейнер на базе `node:20-alpine`.

### Запуск

| Команда | Описание |
|---------|----------|
| `npm run dev` | Локальная разработка |
| `npm run build` | Сборка для production |
| `npm start` | Запуск production сервера |

---

## Связанная документация

### Фронтенд

*   [COMPONENTS.md](COMPONENTS.md) — Компоненты приложения
*   [API_REFERENCE.md](API_REFERENCE.md) — Справочник по API клиенту

### Бэкенд

*   [USER_BACKEND README](../USER_BACKEND/README.md)
*   [API модуль Orders](../USER_BACKEND/API_MODULES/Orders.md)
*   [API модуль Cart](../USER_BACKEND/API_MODULES/Cart.md)
*   [API модуль Payment](../USER_BACKEND/API_MODULES/Payment.md)
*   [API модуль Delivery](../USER_BACKEND/API_MODULES/Delivery.md)
