# Модуль Users (Admin)

Управление пользователями платформы и администраторами.

## Эндпоинты

### `GET /api/v1/users/`
Получение списка пользователей.

*   **Параметры**:
    *   `skip`, `limit`: Пагинация.
    *   `q`: Поиск по email, имени, фамилии.
    *   `is_superuser`: Фильтр по роли.
*   **Ответ**: Список `UserAdminResponse`.

### `GET /api/v1/users/{id}`
Получение детальной информации о пользователе.

### `PATCH /api/v1/users/{id}`
Редактирование пользователя.

*   **Возможности**:
    *   Блокировка (`is_active`).
    *   Назначение суперпользователем (`is_superuser`).
    *   Подтверждение email вручную.

### `POST /api/v1/users/{id}/reset-2fa`
Сброс настройки 2FA для пользователя.
*   **Использование**: Если администратор потерял устройство с 2FA.
*   **Действие**: Удаляет запись из таблицы `admin_2fa`. При следующем входе пользователю придется настроить 2FA заново.

### `POST /api/v1/users/{id}/impersonate`
Вход под именем пользователя (Impersonation).

*   **Требования**: Только для Superuser.
*   **Ответ**: `Token` (access_token, refresh_token) целевого пользователя.
*   **Безопасность**: Refresh token хешируется перед сохранением в БД.
*   **Логирование**: Действие записывается в Audit Log.

### `DELETE /api/v1/users/{id}`
Удаление пользователя.

*   **Требования**: Только для Superuser.
*   **Ограничения**: Нельзя удалить самого себя.
*   **Действия**:
    *   Удаление корзины и её позиций.
    *   Отвязка заказов (user_id = NULL).
    *   Удаление лайков и комментариев.
    *   Удаление статей и связанных взаимодействий.
    *   Удаление 2FA настроек.
    *   Удаление токенов сессий.
*   **Логирование**: Действие записывается в Audit Log.
