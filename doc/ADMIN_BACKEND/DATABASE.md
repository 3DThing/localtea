# База данных (Изменения для Admin Backend)

Admin Backend использует ту же базу данных PostgreSQL, что и User Backend, но добавляет специфичные таблицы для своих нужд.

## Новые таблицы

### 1. `admin_2fa`
Хранит зашифрованные секреты для двухфакторной аутентификации.

| Поле | Тип | Описание |
|------|-----|----------|
| `user_id` | Integer (FK) | Ссылка на таблицу `user`. PK. |
| `secret` | String | **Зашифрованный** (Fernet) секрет TOTP. |
| `is_enabled` | Boolean | Активирована ли 2FA (True после первого успешного входа). |
| `created_at` | DateTime | Дата создания. |

### 2. `admin_action_log`
Журнал аудита действий администраторов.

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | Integer | PK |
| `admin_id` | Integer (FK) | Ссылка на администратора (`user.id`). |
| `action` | String | Тип действия (`create`, `update`, `delete`, `login`, `impersonate`). |
| `entity_id` | Integer | ID затронутой сущности (опционально). |
| `details` | JSONB | Структурированные детали события (например, старые/новые значения). |
| `created_at` | DateTime | Время события. |

## Миграции

Управление схемой осуществляется через **Alembic** из корня проекта.
Миграции для админки находятся в общей папке `alembic/versions`.

*   `xxxx_add_admin_2fa.py`: Создание таблицы `admin_2fa`.
*   `xxxx_add_admin_action_log.py`: Создание таблицы `admin_action_log`.

## Общие модели

Админка активно использует существующие модели:
*   `User` (чтение, редактирование, блокировка).
*   `Order`, `OrderItem` (обработка заказов).
*   `Category`, `Product`, `SKU` (управление каталогом).
